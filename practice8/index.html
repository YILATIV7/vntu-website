<!DOCTYPE html>
<html lang="uk">
<head>
  <title><?=$title?></title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="pad-container">

  <header>
    <h1 class="header-caption"></h1>
    <nav class="nav-main">
      <ul>
        <li><a href="javascript:loadPage('main')">Головна</a></li>
        <li>
          <a href="javascript:loadPage('nuclear-power-plants')">Атомна енергетика</a>
          <ul>
            <li><a href="javascript:loadPage('zaporizhzhia')">Запорізька АЕС</a></li>
            <li><a href="javascript:loadPage('rivne')">Рівненська АЕС</a></li>
            <li><a href="javascript:loadPage('khmelnytskyi')">Хмельницька АЕС</a></li>
            <li><a href="javascript:loadPage('south-ukraine')">Південноукраїн. АЕС</a></li>
            <li><a href="javascript:loadPage('chornobyl')">Чорнобильська АЕС</a></li>
          </ul>
        </li>
        <li>
          <a href="#">Теплоенергетика</a>
          <ul>
            <li><a href="#">Вуглегірська ТЕС</a></li>
            <li><a href="#">Запорізька ТЕС</a></li>
            <li><a href="#">Криворізька ТЕС</a></li>
            <li><a href="#">Бурштинська ТЕС</a></li>
            <li><a href="#">Придніпровська ТЕС</a></li>
          </ul>
        </li>
        <li>
          <a href="#">Гідроенергетика</a>
          <ul>
            <li><a href="#">Дніпровська ГЕС</a></li>
            <li><a href="#">Дністровська ГЕС</a></li>
            <li><a href="#">Кременчуцька ГЕС</a></li>
          </ul>
        </li>
        <li>
          <a href="#">Сонячна енергетика</a>
          <ul>
            <li><a href="#">Нікопольська СЕС</a></li>
            <li><a href="#">Покровська СЕС</a></li>
          </ul>
        </li>
        <li>
          <a href="#">Вітроенергетика</a>
          <ul>
            <li><a href="#">Ботієвська ВЕС</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </header>

  <div id="main_container"></div>

  <div class="comments">
    <h2>Коментарі</h2>
    <p>
      Залишити коментар:
    </p>
    <form action="" method="post">
      <input type="text" name="author" placeholder="Введіть ваше ім'я" value="">
      <textarea name="msg" placeholder="Введіть текст коментаря"></textarea>
      <input type="submit">
    </form>
    <div id="comments_container"></div>
  </div>

  <footer class="footer">
    <div class="about-container">
      <h3>Про сайт</h3>
      <p>
        Сайт розроблено в рамках вивчення дисципліни "Основи WEB-дизайну" у
        Вінницькому національно-технічному університеті
        студентом групи 3ПІ-21б Туренко В. Р.
      </p>
    </div>
    <div class="sources-container">
      <h3>Джерела</h3>
      <ul>
        <li><a href="https://uk.wikipedia.org/wiki/%D0%95%D0%BB%D0%B5%D0%BA%D1%82%D1%80%D0%BE%D0%B5%D0%BD%D0%B5%D1%80%D0%B3%D0%B5%D1%82%D0%B8%D0%BA%D0%B0_%D0%A3%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D0%B8">
          Електроенергетика України - Вікіпедія</a></li>
        <li><a href="https://uk.wikipedia.org/wiki/%D0%AF%D0%B4%D0%B5%D1%80%D0%BD%D0%B0_%D0%B5%D0%BD%D0%B5%D1%80%D0%B3%D0%B5%D1%82%D0%B8%D0%BA%D0%B0_%D0%A3%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D0%B8">
          Ядерна енергетика України - Вікіпедія</a></li>
        <li><a href="https://uk.wikipedia.org/wiki/%D0%90%D1%82%D0%BE%D0%BC%D0%BD%D0%B0_%D0%B5%D0%BB%D0%B5%D0%BA%D1%82%D1%80%D0%BE%D1%81%D1%82%D0%B0%D0%BD%D1%86%D1%96%D1%8F">
          Атомна електростанція - Вікіпедія</a></li>
        <li><a href="https://uk.wikipedia.org/wiki/%D0%A7%D0%BE%D1%80%D0%BD%D0%BE%D0%B1%D0%B8%D0%BB%D1%8C%D1%81%D1%8C%D0%BA%D0%B0_%D0%90%D0%95%D0%A1">
          Чорнобильська АЕС - Вікіпедія</a></li>
        <li><a href="https://uk.wikipedia.org/wiki/%D0%97%D0%B0%D0%BF%D0%BE%D1%80%D1%96%D0%B7%D1%8C%D0%BA%D0%B0_%D0%90%D0%95%D0%A1">
          Запорізька АЕС - Вікіпедія</a></li>
        <li><a href="https://uk.wikipedia.org/wiki/%D0%A0%D1%96%D0%B2%D0%BD%D0%B5%D0%BD%D1%81%D1%8C%D0%BA%D0%B0_%D0%90%D0%95%D0%A1">
          Рівненська АЕС - Вікіпедія</a></li>
        <li><a href="https://uk.wikipedia.org/wiki/%D0%A5%D0%BC%D0%B5%D0%BB%D1%8C%D0%BD%D0%B8%D1%86%D1%8C%D0%BA%D0%B0_%D0%90%D0%95%D0%A1">
          Хмельницька АЕС - Вікіпедія</a></li>
        <li><a href="https://uk.wikipedia.org/wiki/%D0%9F%D1%96%D0%B2%D0%B4%D0%B5%D0%BD%D0%BD%D0%BE%D1%83%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D1%81%D1%8C%D0%BA%D0%B0_%D0%90%D0%95%D0%A1">
          Південноукраїнська АЕС - Вікіпедія</a></li>
      </ul>
    </div>
  </footer>

</div>
<script>
  if (window.localStorage.getItem("currentPage") === null) {
    window.localStorage.setItem("currentPage", "main");
  }
  loadPage(window.localStorage.getItem("currentPage"));
  let form = document.querySelector(".comments form");

  form.addEventListener('submit', (event) => {
    event.preventDefault();

    let xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
        alert("Коментар додано!");
        loadComments(window.localStorage.getItem("currentPage"));
      }
    };
    xhttp.open("POST", "index.php", true);

    // Встановлюємо заголовки запиту
    xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

    let author = form.querySelector("input[name='author']").value;
    let msg = form.querySelector("textarea[name='msg']").value;
    let params = "author=" + author + "&msg=" + msg;

    let formData = new FormData(form);
    console.log(formData);
    let data = new URLSearchParams(formData).toString() + "&page=" + window.localStorage.getItem("currentPage");

    console.log(data);
    xhttp.send(data);
  });

  function loadPage(pageName) {
    // load content
    let xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
        document.getElementById("main_container").innerHTML = this.responseText;
        window.localStorage.setItem("currentPage", pageName);
      }
    };
    xhttp.open("GET", "blocks/"+pageName+".html", true);
    xhttp.send();

    // load title
    let title;
    switch (pageName) {
      case 'main':
        title = 'Головна'; break;
      case 'nuclear-power-plants':
        title = 'Атомна енергетика України'; break;
      case 'chornobyl':
        title = 'Чорнобильська АЕС'; break;
      case 'zaporizhzhia':
        title = 'Запорізька АЕС'; break;
      case 'rivne':
        title = 'Рівненська АЕС'; break;
      case 'khmelnytskyi':
        title = 'Хмельницька АЕС'; break;
      case 'south-ukraine':
        title = 'Південноукраїнська АЕС'; break;
    }

    document.title = title;
    document.querySelector(".header-caption").innerText = title;

    // load comments
    loadComments(pageName);
  }

  function loadComments(pageName) {
    let xhttp2 = new XMLHttpRequest();
    xhttp2.onreadystatechange = function() {
      if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
        document.getElementById("comments_container").innerHTML = this.responseText;
      }
    };
    xhttp2.open("GET", "index.php?page="+pageName, true);
    xhttp2.send();
  }
</script>
</body>
</html>
